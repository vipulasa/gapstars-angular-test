<div class="p-6 max-w-3xl mx-auto">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-semibold">My Todos</h2>
    <button
      (click)="showAddTodo = !showAddTodo"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
    >
      {{ showAddTodo ? 'Close' : 'Add Todo' }}
    </button>
  </div>

  <!-- Add Todo Modal -->
  <div *ngIf="showAddTodo" class="mb-6">
    <app-add-todo (taskAdded)="onTaskAdded()" (closed)="showAddTodo = false"></app-add-todo>
  </div>

  <!-- Search and Sort -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
    <input
      type="text"
      [(ngModel)]="search"
      placeholder="Search tasks..."
      class="w-full sm:w-1/2 border rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-blue-300"
    />
    <select
      [(ngModel)]="sortBy"
      class="w-full sm:w-1/3 border rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-blue-300"
    >
      <option value="priority">Sort by Priority</option>
      <option value="status">Sort by Status</option>
    </select>
  </div>

  <ng-content>
    @if ((todos | todoFilter: search : sortBy).length === 0) {
      <p class="text-center text-gray-500 italic mt-6">
        No todos found. Add a todo by clicking on the Add Todo button
      </p>
    } @else {
      <ul class="space-y-3">
        @for (todo of todos | todoFilter: search : sortBy; track todo.id) {
          <li class="flex flex-col gap-2 bg-white shadow-sm border rounded-lg px-4 py-3">
            <!-- Top Row -->
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <input
                  type="checkbox"
                  class="accent-blue-600"
                  [checked]="todo.done"
                  [disabled]="!canComplete(todo)"
                  (change)="toggleDone(todo)"
                />
                <div>
                  <p class="font-medium" [class.line-through]="todo.done">
                    {{ todo.title }}
                  </p>
                  <p class="text-sm text-gray-500">
                    {{ todo.priority }} â€¢ {{ todo.recurrence }}
                  </p>
                </div>
              </div>
              <button
                (click)="deleteTask(todo.id)"
                class="text-red-500 hover:text-red-700 text-sm"
              >
                Delete
              </button>
            </div>

            <!-- Dependency Info -->
            <div *ngIf="todo.dependencies.length" class="text-sm text-gray-500 pl-8">
              Depends on:
              <ul class="list-disc ml-4">
                @for (depId of todo.dependencies; track depId) {
                  <li>
                    {{ getDependencyTitle(depId) }}
                    <span *ngIf="!isDependencyDone(depId)" class="text-red-500">(not done)</span>
                  </li>
                }
              </ul>
            </div>
          </li>
        }
      </ul>
    }
  </ng-content>
</div>
